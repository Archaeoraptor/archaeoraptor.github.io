<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/uploads/wizard-hat-16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/uploads/wizard-hat-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/uploads/wizard-hat-16.png">
  <link rel="mask-icon" href="/uploads/wizard-hat-32.png" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="google-site-verification" content="OwUki9pTQANwT767yFIY9v_Qx4gl55MFLe3lggNnHbw">
  <meta name="msvalidate.01" content="872DC4637276109A6B54FF149DCABA8A">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Ma Shan Zheng:300,300italic,400,400italic,700,700italic|Noto Sans SC:300,300italic,400,400italic,700,700italic|Noto Serif SC:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://zhangjk98.xyz').hostname,
    root: '/',
    scheme: 'Pisces',
    version: '7.7.1',
    exturl: true,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"padding":18},
    copycode: {"enable":true,"show_result":false,"style":"default"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: true,
    lazyload: true,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="教研室要倒闭啦，师兄毕业跑路啦！">
<meta property="og:type" content="article">
<meta property="og:title" content="教研室服务器维护">
<meta property="og:url" content="https://zhangjk98.xyz/d6da/index.html">
<meta property="og:site_name" content="止息的碎碎念">
<meta property="og:description" content="教研室要倒闭啦，师兄毕业跑路啦！">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/Archaeoraptor/image_resources/ImageofBlog/20191115103425.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Archaeoraptor/image_resources/ImageofBlog/ubuntu-apt.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Archaeoraptor/image_resources/ImageofBlog/ping-ubuntu.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/Archaeoraptor/image_resources/ImageofBlog/xserver.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Archaeoraptor/image_resources/ImageofBlog/apt.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Archaeoraptor/image_resources/ImageofBlog/centos.png">
<meta property="article:published_time" content="2019-11-14T09:37:07.000Z">
<meta property="article:modified_time" content="2020-01-30T13:19:15.538Z">
<meta property="article:author" content="Zhang.jk">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/Archaeoraptor/image_resources/ImageofBlog/20191115103425.png">

<link rel="canonical" href="https://zhangjk98.xyz/d6da/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>教研室服务器维护 | 止息的碎碎念</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-143393734-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-143393734-1');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="止息的碎碎念" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta custom-logo">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">止息的碎碎念</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">阴，气温20℃至32℃</h1>
      
      <a>
        <img class="custom-logo-image" src="/uploads/hollowknight.webp" alt="止息的碎碎念">
      </a>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-heartbeat"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">51</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">8</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">39</span></a>

  </li>
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FyY2hhZW9yYXB0b3I=" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://zhangjk98.xyz/d6da/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/jinmao.webp">
      <meta itemprop="name" content="Zhang.jk">
      <meta itemprop="description" content="in darkest night">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="止息的碎碎念">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          教研室服务器维护
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-14 17:37:07" itemprop="dateCreated datePublished" datetime="2019-11-14T17:37:07+08:00">2019-11-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/102%E7%BD%91%E5%90%A7%E6%97%A5%E5%B8%B8/" itemprop="url" rel="index">
                    <span itemprop="name">102网吧日常</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>教研室要倒闭啦，师兄毕业跑路啦！</p>
<a id="more"></a>
<h2 id="写在前面的话"><a class="markdownIt-Anchor" href="#写在前面的话"></a> 写在前面的话</h2>
<p>不想用vim又不得不在linux下改东西，不要再用nano了，这有个<span class="exturl" data-url="aHR0cHM6Ly93bWRwZC5jb20vcWlhbmctbGllLXR1aS1qaWFuLWxpbnV4emhvbmctZHVhbi13ZW4tYmVuLWJpYW4tamktcWktbWljcm8v" title="https://wmdpd.com/qiang-lie-tui-jian-linuxzhong-duan-wen-ben-bian-ji-qi-micro/">micro<i class="fa fa-external-link"></i></span>, 拿好</p>
<p>安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/bin; curl https://getmic.ro | sudo bash</span><br></pre></td></tr></table></figure>
<p>或者用snap装，装好后开箱即用</p>
<h2 id="安全问题"><a class="markdownIt-Anchor" href="#安全问题"></a> 安全问题</h2>
<p>教研室的服务器之前就被黑过<br />
老师兄装的Ubuntu，默认端口默认用户名超简单密码直接远程登录，行吧<br />
教研室出现了断层，现在的师兄们（以及并夕夕40万却没用过Linux的师姐）Linux都还没我熟，行吧<br />
服务器以后就扔给我了，行吧</p>
<p>之前折腾Docker的时候看日志发现一堆乱七八糟的</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep "Accepted password for root" /var/log/auth.log | awk '&#123;print $11&#125;' | sort | uniq -c | sort -nr | more</span><br><span class="line">grep "Failed password for root" /var/log/auth.log | awk '&#123;print $11&#125;' | sort | uniq -c | sort -nr | more</span><br></pre></td></tr></table></figure>
<p>发现一堆可疑ip几千次登录尝试,哇,又被当小鸡扫了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">3073 Failed</span><br><span class="line">  2593 112.85.42.185</span><br><span class="line">  2471 218.92.0.168</span><br><span class="line">   714 112.85.42.187</span><br><span class="line">   363 218.92.0.188</span><br><span class="line">   261 112.85.42.188</span><br><span class="line">   103 222.186.175.220</span><br><span class="line">   103 222.186.175.148</span><br><span class="line">    86 222.186.180.41</span><br><span class="line">    81 222.186.173.180</span><br><span class="line">    78 222.186.180.8</span><br><span class="line">    78 222.186.180.223</span><br><span class="line">    74 222.186.173.154</span><br><span class="line">    69 222.186.175.161</span><br><span class="line">    65 49.88.112.55</span><br><span class="line">    59 222.186.180.9</span><br><span class="line">    59 222.186.175.182</span><br><span class="line">    57 222.186.180.17</span><br><span class="line">    57 222.186.175.167</span><br><span class="line">    55 222.186.175.202</span><br><span class="line">    55 185.164.72.251</span><br><span class="line">    53 222.186.175.215</span><br><span class="line">    51 222.186.169.194</span><br></pre></td></tr></table></figure>
<p>改一下密码和SSH端口</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i "s/Port .*/Port 你的端口/g" /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>
<p>安装sshfilter或者flai2ban，这里我用的fail2ban。<sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[使用 Fail2Ban 加固你的 Linux 服务器](https://isister.cc/posts/Fail2ban-Basic) 
">[1]</span></a></sup></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install fail2ban</span><br><span class="line">sudo cp /etc/fail2ban/fail2ban.conf /etc/fail2ban/fail2ban.local</span><br><span class="line">sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local</span><br></pre></td></tr></table></figure>
<p>配置文件修改.local, 会像next.yml一样把.conf文件自动覆盖掉（直接修改那两个conf下次更新可能会覆盖掉）。</p>
<p>主要参数就是那个bantime和maxretry，这里我设成2小时和10次</p>
<p>然后启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start fail2ban</span><br><span class="line">systemctl <span class="built_in">enable</span> fail2ban</span><br></pre></td></tr></table></figure>
<p>其他操作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fail2ban-client <span class="built_in">set</span> sshd addignoreip &lt;IP&gt; <span class="comment"># IP白名单</span></span><br><span class="line">fail2ban-client <span class="built_in">set</span> sshd unbanip &lt;IP&gt; <span class="comment"># 解封IP</span></span><br></pre></td></tr></table></figure>
<p>还要配置一下防火墙<br />
iptables很繁琐，不涉及太多配置的情况下可以用UFW</p>
<h3 id="防火墙端口"><a class="markdownIt-Anchor" href="#防火墙端口"></a> 防火墙端口</h3>
<p>端口用的时候要打开，不然会出各种烦人的问题，比如wget下载没开443就会<code>443... failed: Connection refused.</code>，如果你加了~–no-check-certificate`还是failed，那八成是防火墙的问题<br />
查看端口开放状态</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ntlp</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet ip port</span><br></pre></td></tr></table></figure>
<p>Ubuntu里用ufw查看状态</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw status</span><br></pre></td></tr></table></figure>
<p>查看指定端口的状态（没输出可能是没开）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ntlp|grep 443</span><br></pre></td></tr></table></figure>
<p>打开443端口</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -I INPUT -p tcp --dport 443 -j ACCEPT</span><br><span class="line">service iptables save</span><br><span class="line">service iptables restart</span><br></pre></td></tr></table></figure>
<p>使用UFW, 直接</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow 443</span><br></pre></td></tr></table></figure>
<p>用iptables打开指定端口, 一般开80，443，53，22，其他按需打开</p>
<p>可以安装这个来永久保存配置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install iptables-persistent</span><br></pre></td></tr></table></figure>
<h3 id="docker默认修改iptables规则"><a class="markdownIt-Anchor" href="#docker默认修改iptables规则"></a> Docker默认修改iptables规则</h3>
<p>Docker不设置会默认修改iptables规则，将端口暴露在外面，导致端口映射在安全上并没有什么卵用，要设置一下一下，可以看这里<br />
<span class="exturl" data-url="aHR0cHM6Ly93d3cuYmluc3MubWUvYmxvZy9kb2NrZXItcGFzcy10aHJvdWdoLXN5c3RlbS1maXJld2FsbC8=" title="https://www.binss.me/blog/docker-pass-through-system-firewall/">https://www.binss.me/blog/docker-pass-through-system-firewall/<i class="fa fa-external-link"></i></span></p>
<h2 id="https"><a class="markdownIt-Anchor" href="#https"></a> HTTPs</h2>
<p>申请SSL证书</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ssl-cert</span><br></pre></td></tr></table></figure>
<p>然后搞一个自己的域名，因为境内服务器要备案，此计划中道崩殂</p>
<h2 id="运行sudo-apt-get-update报错"><a class="markdownIt-Anchor" href="#运行sudo-apt-get-update报错"></a> 运行<code>sudo apt-get update</code>报错</h2>
<p>写在前面，我看到有的镜像源示例配置都是走的HTTPS，似乎没有必要<br />
详见<span class="exturl" data-url="aHR0cHM6Ly93aHlkb2VzYXB0bm90dXNlaHR0cHMuY29tLw==" title="https://whydoesaptnotusehttps.com/">Why does APT not use HTTPS?<i class="fa fa-external-link"></i></span>。<br />
至于某Debian镜像源上说的什么安装apt-transport-https更是没有必要，画蛇添足</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Get:1 http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu xenial InRelease [454 B]</span><br><span class="line">Get:2 http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu xenial-updates InRelease [454 B]</span><br><span class="line">Get:3 http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu xenial-backports InRelease [454 B]</span><br><span class="line">Get:4 http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu xenial-security InRelease [454 B]</span><br><span class="line">Err:1 http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu xenial InRelease</span><br><span class="line">  Clearsigned file isn&#39;t valid, got &#39;NOSPLIT&#39; (does the network require authentication?)</span><br><span class="line">Err:2 http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu xenial-updates InRelease</span><br><span class="line">  Clearsigned file isn&#39;t valid, got &#39;NOSPLIT&#39; (does the network require authentication?)</span><br><span class="line">Err:3 http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu xenial-backports InRelease</span><br><span class="line">  Clearsigned file isn&#39;t valid, got &#39;NOSPLIT&#39; (does the network require authentication?)</span><br><span class="line">Err:4 http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu xenial-security InRelease</span><br><span class="line">  Clearsigned file isn&#39;t valid, got &#39;NOSPLIT&#39; (does the network require authentication?)</span><br></pre></td></tr></table></figure>
<p>查了一下说是代理的问题，看了一下教研室的工作站竟然还有酸酸乳和bbr，一问师兄说是老板外出的时候想上学校网用这个，行吧</p>
<p>设置一下apt的代理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;apt$ cat apt.conf</span><br><span class="line"></span><br><span class="line">Acquire::http::proxy &quot;http:&#x2F;&#x2F;&lt;proxy&gt;&quot;;</span><br><span class="line">Acquire::https::proxy &quot;https:&#x2F;&#x2F;&lt;proxy&gt;&quot;;</span><br><span class="line">Acquire::ftp::proxy &quot;ftp:&#x2F;&#x2F;&lt;proxy&gt;&quot;;</span><br><span class="line">Acquire::socks::proxy &quot;socks:&lt;proxy&gt;&quot;;</span><br></pre></td></tr></table></figure>
<p>这里我切进目录没找到，发现有个apt.conf.d文件夹，是表示缺省的配置文件，删掉换成apt.conf<br />
比如代理是1.2.3.4，端口1234<br />
就改成<code>Acquire::http::proxy &quot;http://1.2.3.4:1234</code></p>
<p>改了一下发现不对，这边是服务端应该没开代理啊</p>
<p>把代理都删了</p>
<p>感觉可能DNS有问题,切到<code>etc/resolv.conf</code>看了一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nameserver 202.112.14.21</span><br><span class="line">nameserver 202.112.14.11</span><br></pre></td></tr></table></figure>
<p>这个学校的DNS服务不行啊，别的都直通互联网，这个上不了谷歌不说，还经常不对外网提供解析服务<br />
(能ping通,但是nslookup发现不对外网提供服务)<br />
又看了一下工作站的DNS, 果然换过了<br />
校园网暂时也没什么好的DNS，就先换了清华的<br />
(那个DNS不是<code>/etc/resolv.conf</code>下的，要改<code>/etc/resolvconf/resolv.conf.d</code>下的<code>base</code>文件,第一个只是临时的DNS)</p>
<p>还要刷新一下DNS：<code>sudo service networking restart</code></p>
<p>运行<code>sudo apt-get upgrade</code>又报了这个错<code>Hash Sum mismatch</code></p>
<p>查了一下发现就是阿里云镜像源在教育网下的问题</p>
<p>算了,改镜像源吧,换了清华的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Err:1 https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;ubuntu xenial InRelease</span><br><span class="line">  Failed to connect to mirrors.tuna.tsinghua.edu.cn port 443: Connection timed out</span><br></pre></td></tr></table></figure>
<p>依然不行, 决定明天重装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E: Some index files failed to download. They have been ignored, or old ones used instead.</span><br></pre></td></tr></table></figure>
<p>看了一下，工作站那台DNS是<code>cat /etc/resolv.conf</code>是127.0.0.1，是DNSmasq托管的，而服务器上的还是你电的DNS，决定改了。<br />
工作站上应该是这样的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># &#x2F;etc&#x2F;network&#x2F;interfaces</span><br><span class="line">dns-nameservers 8.8.8.8</span><br></pre></td></tr></table></figure>
<p>改了之后服务器的<code>resolv.conf</code>也是<code>127.0.0.1</code>了<br />
又上大清的网站看了一下，发现居然在维护</p>
<img data-src="https://raw.githubusercontent.com/Archaeoraptor/image_resources/ImageofBlog/20191115103425.png" alt="Picture" style="zoom:80%;" />
<p>换成你电的，好了，收工</p>
<img data-src="https://raw.githubusercontent.com/Archaeoraptor/image_resources/ImageofBlog/ubuntu-apt.png" alt="Picture" style="zoom:80%;" />
<p>又报了<code>Target Translations (main/i18n/Translation-en) is configured multiple times in</code>, 查了一下是指定apt源冲突了，删掉一个就好了</p>
<h2 id="查看配置"><a class="markdownIt-Anchor" href="#查看配置"></a> 查看配置</h2>
<p>本来想用neofetch查看一下服务器的配置，结果apt装不了。<br />
看了一下官方文档发现16.10要这样</p>
<p>Add PPA<br />
<code>sudo add-apt-repository ppa:dawidd0811/neofetch</code><br />
Update repositories<br />
<code>sudo apt update</code><br />
Install the package<br />
<code>sudo apt install neofetch</code><br />
（安装neofetch还能下载编译，可能还快一点）</p>
<p>算了，好慢啊，直接用<code>sudo dmidecode</code>看吧，screenfetch也行<br />
英特尔的e5 2630 v4，20核CPU，没显卡。这CPU平时居然没人用，空跑,居然还有公网ip，我仿佛发现了宝藏。不出意外就留给我挥（bei）霍（guo）了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">                         .&#x2F;+o+-       root@labserver</span><br><span class="line">                 yyyyy- -yyyyyy+      OS: Ubuntu 16.04 xenial</span><br><span class="line">              :&#x2F;&#x2F;+&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;-yyyyyyo      Kernel: x86_64 Linux 4.12.14-041214-generic</span><br><span class="line">          .++ .:&#x2F;++++++&#x2F;-.+sss&#x2F;&#96;      Uptime: 21h 36m</span><br><span class="line">        .:++o:  &#x2F;++++++++&#x2F;:--:&#x2F;-      Packages: 718</span><br><span class="line">       o:+o+:++.&#96;..&#96;&#96;&#96;.-&#x2F;oo+++++&#x2F;     Shell: bash 4.3.48</span><br><span class="line">      .:+o:+o&#x2F;.          &#96;+sssoo+&#x2F;    WM: Not Found</span><br><span class="line"> .++&#x2F;+:+oo+o:&#96;             &#x2F;sssooo.   CPU: Intel Xeon CPU E5-2630 v4 @ 3.1GHz</span><br><span class="line">&#x2F;+++&#x2F;&#x2F;+:&#96;oo+o               &#x2F;::--:.   RAM: 1348MiB &#x2F; 32074MiB</span><br><span class="line">\+&#x2F;+o+++&#96;o++o               ++&#x2F;&#x2F;&#x2F;&#x2F;.</span><br><span class="line"> .++.o+++oo+:&#96;             &#x2F;dddhhh.</span><br><span class="line">      .+.o+oo:.          &#96;oddhhhh+</span><br><span class="line">       \+.++o+o&#96;&#96;-&#96;&#96;&#96;&#96;.:ohdhhhhh+</span><br><span class="line">        &#96;:o+++ &#96;ohhhhhhhhyo++os:</span><br><span class="line">          .o:&#96;.syhhhhhhh&#x2F;.oo++o&#96;</span><br><span class="line">              &#x2F;osyyyyyyo++ooo+++&#x2F;</span><br><span class="line">                  &#96;&#96;&#96;&#96;&#96; +oo+++o\:</span><br><span class="line">                         &#96;oo++.</span><br></pre></td></tr></table></figure>
<h2 id="更新"><a class="markdownIt-Anchor" href="#更新"></a> 更新</h2>
<p>发现不是镜像源的问题，是你电的镜像源没安排上https，这个服务器好像是证书的问题，https全都用不了，wget也不行。</p>
<h2 id="滚动升级"><a class="markdownIt-Anchor" href="#滚动升级"></a> 滚动升级</h2>
<p>不存在的，这又不是arch系，不要乱升，乱升级滚挂了是要背锅的<br />
要升可以用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo do-release-upgrade</span><br></pre></td></tr></table></figure>
<p>升完记得把apt源给换了<br />
看到有安全更新，说</p>
<blockquote>
<p><em><strong>System restart required</strong></em></p>
</blockquote>
<p>reboot一下就行了</p>
<h2 id="网络问题"><a class="markdownIt-Anchor" href="#网络问题"></a> 网络问题</h2>
<p>很迷，有的地方很快，有的地方就几乎慢到断线。我的联通就经常ping不同。<br />
据说老蔡师兄他那里也经常ping不通</p>
<img data-src="https://raw.githubusercontent.com/Archaeoraptor/image_resources/ImageofBlog/ping-ubuntu.jpg" alt="Picture" style="zoom:60%;" />
<p>测试了一下服务器的下载速度，50M/s</p>
<!-- 查看实时网速NetHogs -->
<h2 id="备份和恢复"><a class="markdownIt-Anchor" href="#备份和恢复"></a> 备份和恢复</h2>
<p>师兄也没装什么东西，用的cp直接备份了点文件，一言不合重装系统。<br />
先暂时用cp备份一次<br />
挂载一下盘(比如挂到/mnt/mydata)，用cp复制<br />
(挂载看这里<sup id="fnref:3"><a href="#fn:3" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[细说linux挂载——mount，及其他……](https://forum.ubuntu.org.cn/viewtopic.php?f=120&t=257333) ">[3]</span></a></sup>)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/sdb7 /mnt</span><br><span class="line">nohup cp -pdr /srv /mnt/mydata &gt;&gt; logs.out 2&gt;&amp;1 &amp;</span><br><span class="line">umount /dev/sdb7</span><br></pre></td></tr></table></figure>
<p>这样将/srv目录下的文件全部拷贝到mydata下面.<br />
文件很大，cp没有进度条，以后试试gcp之类的命令，先这样吧</p>
<p>看了一下，有接近300G的数据，用cp命令太慢了<br />
用dd，把\srv目录底下的迁过去,整盘拷贝（dd命令不要乱用，一不小心就删库了）</p>
<p>拷贝完<code>umount /mydata</code>再拔</p>
<p>下次试试rsync同步，据说能断点续传和md5验证</p>
<h2 id="使用教研室服务器下载"><a class="markdownIt-Anchor" href="#使用教研室服务器下载"></a> 使用教研室服务器下载</h2>
<p>教研室的服务器有一个单独的猫和ip，网速绝大多数时候不低于50M/s，今天才发现比我的小破工位上的网速快不少。<br />
以后下数据集和数据库文件之类的大东西就用它了！</p>
<h2 id="使用tmux"><a class="markdownIt-Anchor" href="#使用tmux"></a> 使用Tmux</h2>
<p>（其实MobaXterm有一个叫Multiexec的功能）<br />
正在备份文件结果网断了（没办法，校园网就是这么…）<br />
这时就要用tmux之类的工具了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install tmux</span><br></pre></td></tr></table></figure>
<h2 id="图形界面"><a class="markdownIt-Anchor" href="#图形界面"></a> 图形界面</h2>
<p>MobaXterm内嵌有Xserver，可以调出图形化窗口。<br />
比如nedit,Emacs之类的<br />
<img data-src="https://raw.githubusercontent.com/Archaeoraptor/image_resources/ImageofBlog/xserver.png" alt="Picture" style="zoom:80%;" /><br />
已经足够应付简单的图形化界面需求了<br />
完整的桌面需求请直接VNC或teamviewer到工作站操作。</p>
<h2 id="卸载遗留的docker并重装"><a class="markdownIt-Anchor" href="#卸载遗留的docker并重装"></a> 卸载遗留的Docker并重装</h2>
<p>目前还报这样的错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cannot connect to the Docker daemon at unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock. Is the docker daemon running?</span><br></pre></td></tr></table></figure>
<p>似乎重装iptables的时候会直接把那个Docker的一部分依赖卸掉<br />
（Docker好像还会直接修改默认的防火墙规则，emmmm)</p>
<p>更新，解决了，是网络问题，离线装就好了</p>
<h2 id="教研室的阿里云"><a class="markdownIt-Anchor" href="#教研室的阿里云"></a> 教研室的阿里云</h2>
<p>真的，有毒哇<br />
<img data-src="https://raw.githubusercontent.com/Archaeoraptor/image_resources/ImageofBlog/apt.png" alt="Picture" style="zoom:80%;" /><br />
是的，师兄跟我说没有apt。。。<strong>行吧</strong></p>
<p>装一个</p>
<p>等等，不对劲，这是Centos啊</p>
<img data-src="https://raw.githubusercontent.com/Archaeoraptor/image_resources/ImageofBlog/centos.png" alt="Picture" style="zoom:80%;" />
<p>行吧…那没事了。师兄真的…我感觉我上了贼船</p>
<h2 id="报备"><a class="markdownIt-Anchor" href="#报备"></a> 报备</h2>
<p>按学校信息中心的要求，固定IP都需要申请报备，还有一堆乱七八糟的事</p>
<h3 id="系统日志和杀毒"><a class="markdownIt-Anchor" href="#系统日志和杀毒"></a> 系统日志和杀毒</h3>
<p>学校信息中心要求备份系统日志和杀软。<br />
然而这Linux有什么装杀软的必要吗？防火墙就完事了。<br />
行吧，交差还是要装模做样的应付一下</p>
<p>安装ClamAV：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install clamav</span><br></pre></td></tr></table></figure>
<p>直接扫描报错了，要升级病毒库<code>sudo freshclam</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LibClamAV Error: cli_loaddbdir(): No supported database files found in &#x2F;var&#x2F;lib&#x2F;clamav</span><br><span class="line">ERROR: Can&#39;t open file or directory</span><br></pre></td></tr></table></figure>
<p>然后扫一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clamscan -r --bell -i /</span><br></pre></td></tr></table></figure>
<p>系统安装日志，不知道要交什么，索性把apt和dpkg的日志交了,在<code>/var/log/</code>和<code>/var/log/apt/</code>目录下面</p>
<h3 id="端口报备"><a class="markdownIt-Anchor" href="#端口报备"></a> 端口报备</h3>
<p>一般22，80，443，再加上几个常用的端口就够了<br />
实在不行还有端口转发</p>
<p>看一下开了的端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -znv 211.XXX.XXX.XXX 1-10000  2&gt;&amp;1 | grep succeeded</span><br></pre></td></tr></table></figure>
<h3 id="域名"><a class="markdownIt-Anchor" href="#域名"></a> 域名</h3>
<p>暂时还没有，备案麻烦没弄</p>
<h2 id="清理trash"><a class="markdownIt-Anchor" href="#清理trash"></a> 清理Trash</h2>
<p>工作站桌面变得非常卡，clamscan扫描home目录也扫了整整两天，看了一下发现有前前任师兄几百个G的数据。使用rm之后跑到了.local文件夹下。使用跑路命令把它们删掉。(最好不要把 .local全删了，只删Trash就行了<code>.local/share/Trash</code>)</p>
<h2 id="使用smartdns"><a class="markdownIt-Anchor" href="#使用smartdns"></a> 使用SmartDNS</h2>
<p>今天SmartDNS 开源了，决定试试，安装看这里<span class="exturl" data-url="aHR0cHM6Ly9weW11bXUuZ2l0aHViLmlvL3NtYXJ0ZG5zLw==" title="https://pymumu.github.io/smartdns/">https://pymumu.github.io/smartdns/<i class="fa fa-external-link"></i></span>,Docker版本用这个<sup id="fnref:2"><a href="#fn:2" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[smartdns的Docker镜像](https://hub.docker.com/u/ghostry)
">[2]</span></a></sup></p>
<p>看到有教程说Ubuntu还要设置一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">disable</span> systemd-resolved</span><br><span class="line">sudo systemctl stop systemd-resolved</span><br><span class="line">sudo vi /etc/resolv.conf</span><br><span class="line">nameserver 127.0.0.1</span><br></pre></td></tr></table></figure>
<p>选DNS参考这里<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLnNray5tb2UvcG9zdC93aGljaC1wdWJsaWMtZG5zLXRvLXVzZQ==" title="https://blog.skk.moe/post/which-public-dns-to-use">https://blog.skk.moe/post/which-public-dns-to-use<i class="fa fa-external-link"></i></span></p>
<h2 id="其他"><a class="markdownIt-Anchor" href="#其他"></a> 其他</h2>
<p>Gitlab占用过高的问题等见瞎折腾记录(其实没有特殊需求可以用Gogs，小声逼逼)<br />
在服务器上部署jupyter参考<span class="exturl" data-url="aHR0cHM6Ly9iaXRtaW5ndy5jb20vMjAxNy8wNy8wOS9ydW4tanVweXRlci1ub3RlYm9vay1zZXJ2ZXIv" title="https://bitmingw.com/2017/07/09/run-jupyter-notebook-server/">搭建 ipython/jupyter notebook 服务器<i class="fa fa-external-link"></i></span></p>
<h2 id="远程开发"><a class="markdownIt-Anchor" href="#远程开发"></a> 远程开发</h2>
<p>为什么要远程呢，因为我的电脑是小破i5，8G内存，装双系统不太行，虚拟机更不行。用wsl真的不如直接上服务器20核CPU、工作站两块1080pi（还有单独的网线和公网IP）。配合SSH端口转发和VSCode、JB全家桶，还是很舒服的。</p>
<h3 id="python多版本管理"><a class="markdownIt-Anchor" href="#python多版本管理"></a> python多版本管理</h3>
<p>python的包管理是个很麻烦的事，坑不少，尤其是在大家都用的服务器上。（这上面有2.7，3.5，3.6和师兄炼丹装的conda3.7、3.6，不要问我为什么linux装conda，师兄干的）</p>
<p>我用自己的linux用户可以避开root用户底下一些混乱环境（比如conda）<br />
主要的问题是切换python版本和python包管理，切换python版本一般用pyenv；包管理选择很多，一直没发现特别完美的工具。</p>
<h4 id="pyenv"><a class="markdownIt-Anchor" href="#pyenv"></a> pyenv</h4>
<p>pyenv用来切换python版本，配合其他工具管理包</p>
<h4 id="venv"><a class="markdownIt-Anchor" href="#venv"></a> venv</h4>
<p>python3官方的包管理工具</p>
<h4 id="pipenv"><a class="markdownIt-Anchor" href="#pipenv"></a> pipenv</h4>
<p>一个类似Ruby的Bundler的东西<br />
纯指定依赖，使用体验比上面那个好，有一点慢<br />
（不推荐在win上用）</p>
<p>就跟npm差不多，和node_modules差不多的Pipfile（存放本地包），和npm的package-lock.json差不多的Pipfile.lock（版本锁）</p>
<h4 id="poetry"><a class="markdownIt-Anchor" href="#poetry"></a> Poetry</h4>
<p>这个和上面那个很像，这几个工具在逼乎、v2ex以及外网等地有很多撕逼和纷争，此处不评价。</p>
<p>poetry还能用来打包</p>
<h4 id="docker虚拟机"><a class="markdownIt-Anchor" href="#docker虚拟机"></a> Docker&amp;虚拟机</h4>
<p>可以，一般没有必要，真机就挺好。<br />
Docker的镜像有官方的python，但是非常大，上G。如果自己写Dockerfile构建一个，缩减镜像，调度每个容器的内存，都是远比前面那几个东西麻烦的事情。<br />
Docker并不适合个人开发环境，直接跑真机它香吗。<br />
Docker在调试的时候真的难受，不理解为什么会有人把它<br />
虽然Docker本身并不吃你太多内存，但是Docker容器跑起来，如果不调度和限制，吃内存还是很猛的。</p>
<p>但是这么一配置，怎么比原来麻烦多了，Docker教徒吹嘘的部署方便这里在需要调试的时候并没有什么优势。</p>
<h2 id="部署项目"><a class="markdownIt-Anchor" href="#部署项目"></a> 部署项目</h2>
<h3 id="python项目"><a class="markdownIt-Anchor" href="#python项目"></a> python项目</h3>
<p>这里以开源标注工具doccano为例（该项目提供了Docker镜像和直接部署的方法以及docker-compose示例文件，还给了aws等一键部署脚本）</p>
<p>我们clone下来，修改settings.py文件</p>
<p>最简单的方法就是直接用官方的镜像</p>
<p>这里用新建虚拟环境运行项目的方式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ virtualenv venv --python=python3.6</span><br></pre></td></tr></table></figure>
<h2 id="一次被黑记录"><a class="markdownIt-Anchor" href="#一次被黑记录"></a> 一次被黑记录</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CPU  [||||||||||||||||                 51.8%]   CPU -    51.8%  nice:     0.0%  ctx_sw:    8K   MEM -   21.7%  active:    5.31G   SWAP -    0.0%   LOAD    20-core</span><br><span class="line">MEM  [|||||||                          21.7%]   user:    51.3%  irq:      0.0%  inter:   5508   total:  31.3G  inactive:  4.27G   total:    976M  </span><br><span class="line">····</span><br><span class="line">lo                         0b     0b   999.5  0.0   2.34G 2.44M   2654 root        67h8:58 16    0 S    ? ?    .&#x2F;cron</span><br><span class="line">2020-01-15 16:17:54 CST</span><br></pre></td></tr></table></figure>
<p>症状：昨天root上不去了，rsa密钥也挂了，以为是网的问题，今天一试还不行。用自己的另一个账号登了一下，发现<code>su root</code>居然permission denied了。怀疑是被黑了，一看系统占用，有挖矿程序在跑。看了一下系统日志，是13号被黑的，照着网上清了一遍。从此禁用密码登录（之前就想禁，师兄嫌麻烦）。MySQL也禁用密码改ssl</p>
<p>clamav再扫一遍</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup clamscan -r /root 2 &gt;&gt; err.out &amp;</span><br></pre></td></tr></table></figure>
<h2 id="注"><a class="markdownIt-Anchor" href="#注"></a> 注</h2>
<div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><span class="exturl" data-url="aHR0cHM6Ly9pc2lzdGVyLmNjL3Bvc3RzL0ZhaWwyYmFuLUJhc2lj" title="https://isister.cc/posts/Fail2ban-Basic">使用 Fail2Ban 加固你的 Linux 服务器<i class="fa fa-external-link"></i></span><a href="#fnref:1" rev="footnote"> ↩</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><span class="exturl" data-url="aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS91L2dob3N0cnk=" title="https://hub.docker.com/u/ghostry">smartdns的Docker镜像<i class="fa fa-external-link"></i></span><a href="#fnref:2" rev="footnote"> ↩</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><span class="exturl" data-url="aHR0cHM6Ly9mb3J1bS51YnVudHUub3JnLmNuL3ZpZXd0b3BpYy5waHA/Zj0xMjAmYW1wO3Q9MjU3MzMz" title="https://forum.ubuntu.org.cn/viewtopic.php?f=120&amp;t=257333">细说linux挂载——mount，及其他……<i class="fa fa-external-link"></i></span><a href="#fnref:3" rev="footnote"> ↩</a></span></li></ol></div></div>
    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/Linux/" rel="tag"><i class="fa fa-tag"></i> Linux</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/1609/" rel="prev" title="Nginx部署网站">
      <i class="fa fa-chevron-left"></i> Nginx部署网站
    </a></div>
      <div class="post-nav-item">
    <a href="/a7d1/" rel="next" title="不要尝试sudo apt remove iptables">
      不要尝试sudo apt remove iptables <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    
  
  <div class="comments">
  <script src="https://utteranc.es/client.js" repo="Archaeoraptor/archaeoraptor.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script>
  </div>
  
  

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#写在前面的话"><span class="nav-number">1.</span> <span class="nav-text"> 写在前面的话</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安全问题"><span class="nav-number">2.</span> <span class="nav-text"> 安全问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#防火墙端口"><span class="nav-number">2.1.</span> <span class="nav-text"> 防火墙端口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#docker默认修改iptables规则"><span class="nav-number">2.2.</span> <span class="nav-text"> Docker默认修改iptables规则</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#https"><span class="nav-number">3.</span> <span class="nav-text"> HTTPs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#运行sudo-apt-get-update报错"><span class="nav-number">4.</span> <span class="nav-text"> 运行sudo apt-get update报错</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看配置"><span class="nav-number">5.</span> <span class="nav-text"> 查看配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更新"><span class="nav-number">6.</span> <span class="nav-text"> 更新</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#滚动升级"><span class="nav-number">7.</span> <span class="nav-text"> 滚动升级</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#网络问题"><span class="nav-number">8.</span> <span class="nav-text"> 网络问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#备份和恢复"><span class="nav-number">9.</span> <span class="nav-text"> 备份和恢复</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用教研室服务器下载"><span class="nav-number">10.</span> <span class="nav-text"> 使用教研室服务器下载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用tmux"><span class="nav-number">11.</span> <span class="nav-text"> 使用Tmux</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#图形界面"><span class="nav-number">12.</span> <span class="nav-text"> 图形界面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#卸载遗留的docker并重装"><span class="nav-number">13.</span> <span class="nav-text"> 卸载遗留的Docker并重装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#教研室的阿里云"><span class="nav-number">14.</span> <span class="nav-text"> 教研室的阿里云</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#报备"><span class="nav-number">15.</span> <span class="nav-text"> 报备</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#系统日志和杀毒"><span class="nav-number">15.1.</span> <span class="nav-text"> 系统日志和杀毒</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#端口报备"><span class="nav-number">15.2.</span> <span class="nav-text"> 端口报备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#域名"><span class="nav-number">15.3.</span> <span class="nav-text"> 域名</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#清理trash"><span class="nav-number">16.</span> <span class="nav-text"> 清理Trash</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用smartdns"><span class="nav-number">17.</span> <span class="nav-text"> 使用SmartDNS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他"><span class="nav-number">18.</span> <span class="nav-text"> 其他</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#远程开发"><span class="nav-number">19.</span> <span class="nav-text"> 远程开发</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#python多版本管理"><span class="nav-number">19.1.</span> <span class="nav-text"> python多版本管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#pyenv"><span class="nav-number">19.1.1.</span> <span class="nav-text"> pyenv</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#venv"><span class="nav-number">19.1.2.</span> <span class="nav-text"> venv</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pipenv"><span class="nav-number">19.1.3.</span> <span class="nav-text"> pipenv</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#poetry"><span class="nav-number">19.1.4.</span> <span class="nav-text"> Poetry</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#docker虚拟机"><span class="nav-number">19.1.5.</span> <span class="nav-text"> Docker&amp;虚拟机</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#部署项目"><span class="nav-number">20.</span> <span class="nav-text"> 部署项目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#python项目"><span class="nav-number">20.1.</span> <span class="nav-text"> python项目</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一次被黑记录"><span class="nav-number">21.</span> <span class="nav-text"> 一次被黑记录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#注"><span class="nav-number">22.</span> <span class="nav-text"> 注</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Zhang.jk"
      src="/uploads/jinmao.webp">
  <p class="site-author-name" itemprop="name">Zhang.jk</p>
  <div class="site-description" itemprop="description">in darkest night</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">39</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FyY2hhZW9yYXB0b3I=" title="GitHub → https://github.com/archaeoraptor"><i class="fa fa-fw fa-github"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOnpoYW5nams2N0BnbWFpbC5jb20=" title="E-Mail → mailto:zhangjk67@gmail.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</span>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → /atom.xml"><i class="fa fa-fw fa-rss"></i>RSS</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      友链
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly91ZXN0Yy5pY3U=" title="https://uestc.icu">uestc.icu</span>
        </li>
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly96aGFuZ3NodXFpYW8ub3Jn" title="https://zhangshuqiao.org">米米的博客</span>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heartbeat"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">止息</span>
</div>
  <div class="powered-by">由 <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <span class="exturl theme-link" data-url="aHR0cHM6Ly9waXNjZXMudGhlbWUtbmV4dC5vcmc=">NexT.Pisces</span> v7.7.1
  </div>

        








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.6" zIndex="-1" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-ribbon@1/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>









<script>
if (document.querySelectorAll('div.pdf').length) {
  NexT.utils.getScript('//cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js', () => {
    document.querySelectorAll('div.pdf').forEach(element => {
      PDFObject.embed(element.getAttribute('target'), element, {
        pdfOpenParams: {
          navpanes: 0,
          toolbar: 0,
          statusbar: 0,
          pagemode: 'thumbs',
          view: 'FitH'
        },
        PDFJS_URL: '/lib/pdf/web/viewer.html',
        height: element.getAttribute('height') || '500px'
      });
    });
  }, window.PDFObject);
}
</script>




  

  
      
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex@0/dist/katex.min.css">
  <script src="//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css">


  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout: 3000,
        priority: true,
        ignores: [uri => uri.includes('#'),uri => uri == 'https://zhangjk98.xyz/d6da/',]
      });
      });
  </script>

</body>
</html>
